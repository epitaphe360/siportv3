```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     WORKFLOWS VISITEUR - VALIDATION COMPLÃˆTE                   â•‘
â•‘                          19 DÃ‰CEMBRE 2025 - âœ… OK                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WORKFLOW #1: INSCRIPTIONVISITEUR GRATUIT (7 Ã©tapes)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚ START â†’ /visitor/register/free (VisitorFreeRegistration.tsx)               â”‚
â”‚                                                                              â”‚
â”‚ 1ï¸âƒ£  Form Saisie                                                             â”‚
â”‚     âœ… PrÃ©nom, Nom, Email, TÃ©lÃ©phone, Pays, Secteur                       â”‚
â”‚     Route: POST /visitor/register/free                                      â”‚
â”‚                                                                              â”‚
â”‚ 2ï¸âƒ£  Supabase Auth signUp                                                    â”‚
â”‚     âœ… Password: `temp-${Date.now()}-${random}`                            â”‚
â”‚     âœ… Utilisateur crÃ©Ã© mais NON loginnable (password alÃ©atoire)           â”‚
â”‚                                                                              â”‚
â”‚ 3ï¸âƒ£  Insert users table                                                      â”‚
â”‚     âœ… visitor_level: 'free'                                                â”‚
â”‚     âœ… status: 'pending'                                                    â”‚
â”‚     âœ… type: 'visitor'                                                      â”‚
â”‚                                                                              â”‚
â”‚ 4ï¸âƒ£  ğŸ¯ Call generate-visitor-badge                                          â”‚
â”‚     âœ… Fonction: supabase/functions/generate-visitor-badge                 â”‚
â”‚     âœ… GÃ©nÃ¨re JWT (header.payload.signature)                               â”‚
â”‚     âœ… CrÃ©e donnÃ©es QR code                                                 â”‚
â”‚     âœ… Stocke dans digital_badges table                                    â”‚
â”‚     âœ… Badge Type: 'visitor_free'                                           â”‚
â”‚     âœ… Zones d'accÃ¨s: ['public', 'exhibition_hall']                        â”‚
â”‚                                                                              â”‚
â”‚ 5ï¸âƒ£  ğŸ“§ Call send-visitor-welcome-email                                      â”‚
â”‚     âœ… Fonction: supabase/functions/send-visitor-welcome-email             â”‚
â”‚     âœ… Template: Email FREE avec CTA "Passer au VIP"                       â”‚
â”‚     âœ… Contient:                                                             â”‚
â”‚         - Bienvenue et confirmation                                         â”‚
â”‚         - DÃ©tails salon (dates, lieu, horaires)                            â”‚
â”‚         - Lien vers badge QR personnel                                      â”‚
â”‚         - Offre VIP (299.99 USD)                                            â”‚
â”‚         - Support contact                                                   â”‚
â”‚     âœ… Via Resend API                                                       â”‚
â”‚                                                                              â”‚
â”‚ 6ï¸âƒ£  ğŸšª Logout automatique                                                   â”‚
â”‚     âœ… await supabase.auth.signOut()                                        â”‚
â”‚     âœ… Session dÃ©truite                                                     â”‚
â”‚                                                                              â”‚
â”‚ 7ï¸âƒ£  ğŸ  Redirect HOME                                                        â”‚
â”‚     âœ… ROUTES.HOME avec message: "VÃ©rifiez votre email..."                 â”‚
â”‚                                                                              â”‚
â”‚ END â†’ Home Page avec notification                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WORKFLOW #2: INSCRIPTION VISITEUR VIP (12 Ã©tapes)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚ START â†’ /visitor/register/vip (VisitorVIPRegistration.tsx)                 â”‚
â”‚                                                                              â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” PHASE 1: INSCRIPTION (Ã‰tapes 1-8) â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”         â”‚
â”‚                                                                              â”‚
â”‚ 1ï¸âƒ£  Form Saisie + Photo                                                     â”‚
â”‚     âœ… PrÃ©nom, Nom, Email, TÃ©lÃ©phone, Pays, Secteur, Position, Entreprise â”‚
â”‚     âœ… Photo OBLIGATOIRE (max 5MB, type image)                             â”‚
â”‚     âœ… Mot de passe RÃ‰EL (8+ chars, maj/min/chiffre)                       â”‚
â”‚                                                                              â”‚
â”‚ 2ï¸âƒ£  ğŸ“¸ Upload photo â†’ Storage                                               â”‚
â”‚     âœ… Bucket: 'public'                                                     â”‚
â”‚     âœ… Chemin: `visitor-photos/${filename}`                                â”‚
â”‚     âœ… URL publique rÃ©cupÃ©rÃ©e: photoUrl                                    â”‚
â”‚                                                                              â”‚
â”‚ 3ï¸âƒ£  Supabase Auth signUp                                                    â”‚
â”‚     âœ… Password: Mot de passe rÃ©el utilisateur                              â”‚
â”‚     âœ… Utilisateur crÃ©Ã© (NON activÃ© tant qu'aucun paiement)                â”‚
â”‚                                                                              â”‚
â”‚ 4ï¸âƒ£  Insert users table                                                      â”‚
â”‚     âœ… visitor_level: 'vip'                                                 â”‚
â”‚     âœ… status: 'pending_payment' (ğŸ”´ LOCKED)                                â”‚
â”‚     âœ… profile.photoUrl: URL stockÃ©e                                        â”‚
â”‚                                                                              â”‚
â”‚ 5ï¸âƒ£  ğŸ’³ Insert payment_request                                               â”‚
â”‚     âœ… amount: 299.99 EUR                                                   â”‚
â”‚     âœ… status: 'pending'                                                    â”‚
â”‚     âœ… metadata: { type: 'visitor_vip_upgrade', ... }                       â”‚
â”‚                                                                              â”‚
â”‚ 6ï¸âƒ£  ğŸ“§ Call send-visitor-welcome-email                                      â”‚
â”‚     âœ… ParamÃ¨tre: includePaymentInstructions: true                          â”‚
â”‚     âœ… Template: Email VIP avec CTA paiement                                â”‚
â”‚     âœ… Contient:                                                             â”‚
â”‚         - Compte crÃ©Ã© confirmÃ©                                              â”‚
â”‚         - Instructions paiement 299.99                                      â”‚
â”‚         - Boutons Stripe/PayPal/CMI Maroc                                   â”‚
â”‚         - Avantages VIP Premium (B2B illimitÃ©s, zones VIP, etc)            â”‚
â”‚         - âš ï¸ "AccÃ¨s activÃ© aprÃ¨s paiement"                                  â”‚
â”‚     âœ… Via Resend API                                                       â”‚
â”‚                                                                              â”‚
â”‚ 7ï¸âƒ£  ğŸšª Logout automatique                                                   â”‚
â”‚     âœ… await supabase.auth.signOut()                                        â”‚
â”‚                                                                              â”‚
â”‚ 8ï¸âƒ£  ğŸ’° Redirect /visitor/subscription                                       â”‚
â”‚     âœ… Page paiement Stripe/PayPal                                          â”‚
â”‚     âœ… Passage state: { userId, email, name, fromRegistration: true }      â”‚
â”‚                                                                              â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” PHASE 2: PAIEMENT VALIDÃ‰ (Ã‰tapes 9-12) â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚                                                                              â”‚
â”‚ ğŸ’³ WEBHOOK STRIPE: checkout.session.completed                              â”‚
â”‚    Fichier: supabase/functions/stripe-webhook/index.ts                    â”‚
â”‚                                                                              â”‚
â”‚ 9ï¸âƒ£  ğŸ¯ Call generate-visitor-badge (avec PHOTO)                             â”‚
â”‚     âœ… Fonction: supabase/functions/generate-visitor-badge                 â”‚
â”‚     âœ… ParamÃ¨tres:                                                           â”‚
â”‚         - userId, email, name                                              â”‚
â”‚         - level: 'vip'                                                      â”‚
â”‚         - photoUrl: userData.profile.photoUrl                              â”‚
â”‚         - includePhoto: true (pour VIP)                                     â”‚
â”‚     âœ… JWT Payload inclut:                                                  â”‚
â”‚         - zones: ['public', 'exhibition_hall', 'vip_lounge', 'networking']â”‚
â”‚         - photo_url dans QR data                                            â”‚
â”‚     âœ… Badge Type: 'visitor_premium'                                        â”‚
â”‚     âœ… Token expires: 1 an                                                  â”‚
â”‚     âœ… Nonce anti-replay gÃ©nÃ©rÃ©                                             â”‚
â”‚                                                                              â”‚
â”‚ ğŸ”Ÿ  ğŸ“§ Call send-visitor-welcome-email                                      â”‚
â”‚     âœ… ParamÃ¨tre: paymentConfirmed: true                                    â”‚
â”‚     âœ… Template: Email de CONFIRMATION paiement                             â”‚
â”‚     âœ… Contient:                                                             â”‚
â”‚         - âœ… Paiement reÃ§u avec succÃ¨s                                      â”‚
â”‚         - âœ… Badge VIP gÃ©nÃ©rÃ© avec votre photo                              â”‚
â”‚         - âœ… AccÃ¨s immÃ©diat tableau de bord                                 â”‚
â”‚         - Zones VIP activÃ©es                                               â”‚
â”‚         - Instructions planner rendez-vous B2B                              â”‚
â”‚     âœ… Via Resend API                                                       â”‚
â”‚                                                                              â”‚
â”‚ 1ï¸âƒ£1ï¸âƒ£ ğŸ”“ Update user status â†’ 'active'                                       â”‚
â”‚     âœ… UPDATE users SET status = 'active' WHERE id = userId                â”‚
â”‚     âœ… Utilisateur peut maintenant SE CONNECTER                             â”‚
â”‚                                                                              â”‚
â”‚ 1ï¸âƒ£2ï¸âƒ£ ğŸ‰ Login autorisÃ©                                                     â”‚
â”‚     âœ… User peut accÃ©der /login avec ses credentials                        â”‚
â”‚     âœ… Dashboard /visitor/dashboard maintenant accessible                   â”‚
â”‚     âœ… Badge disponible dans le dashboard                                   â”‚
â”‚                                                                              â”‚
â”‚ END â†’ User Connected + Dashboard Accessible + VIP Active                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           ROUTES CONFIGURÃ‰ES                                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘  /visitor/register ..................... VisitorRegistrationChoice (choice)    â•‘
â•‘                                                                                â•‘
â•‘  /visitor/register/free ................ VisitorFreeRegistration (formulaire) â•‘
â•‘  âœ… ImplÃ©mentÃ© - 7 Ã©tapes complÃ¨tes                                           â•‘
â•‘                                                                                â•‘
â•‘  /visitor/register/vip ................. VisitorVIPRegistration (formulaire)  â•‘
â•‘  âœ… ImplÃ©mentÃ© - 12 Ã©tapes complÃ¨tes (inscr + webhook)                       â•‘
â•‘                                                                                â•‘
â•‘  /visitor/subscription ................. Page paiement Stripe/PayPal          â•‘
â•‘  âœ… ImplÃ©mentÃ© - Redirection aprÃ¨s inscription VIP                           â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                       FONCTIONS SUPABASE IMPLIQUÃ‰ES                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘  ğŸ“Œ generate-visitor-badge (225 lignes)                                       â•‘
â•‘     â€¢ CrÃ©e JWT avec zones d'accÃ¨s selon level                                â•‘
â•‘     â€¢ GÃ©nÃ¨re donnÃ©es QR code                                                 â•‘
â•‘     â€¢ Stocke dans digital_badges table                                       â•‘
â•‘     â€¢ Support photo pour VIP                                                 â•‘
â•‘     âœ… VALIDÃ‰ & FONCTIONNEL                                                   â•‘
â•‘                                                                                â•‘
â•‘  ğŸ“§ send-visitor-welcome-email (391 lignes)                                   â•‘
â•‘     â€¢ Template FREE: Bienvenue + CTA passer au VIP                           â•‘
â•‘     â€¢ Template VIP (prÃ©-paiement): Instructions paiement                     â•‘
â•‘     â€¢ Template VIP (post-paiement): Confirmation + badge                     â•‘
â•‘     â€¢ ParamÃ¨tres: includePaymentInstructions, paymentConfirmed               â•‘
â•‘     â€¢ Via Resend API                                                         â•‘
â•‘     âœ… VALIDÃ‰ & FONCTIONNEL                                                   â•‘
â•‘                                                                                â•‘
â•‘  ğŸ’³ stripe-webhook (238 lignes)                                               â•‘
â•‘     â€¢ Valide signature Stripe                                                â•‘
â•‘     â€¢ Appelle generate-visitor-badge avec photo                              â•‘
â•‘     â€¢ Appelle send-visitor-welcome-email avec confirmation                   â•‘
â•‘     â€¢ Met Ã  jour status = 'active'                                           â•‘
â•‘     âœ… VALIDÃ‰ & COMPLET (Ã©tapes 9-11)                                         â•‘
â•‘                                                                                â•‘
â•‘  ğŸ’³ paypal-webhook (176 lignes)                                               â•‘
â•‘     â€¢ Alternative PayPal avec mÃªme logique                                   â•‘
â•‘     âœ… VALIDÃ‰                                                                 â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        TABLES SUPABASE IMPLIQUÃ‰ES                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘  ğŸ‘¥ users                                                                      â•‘
â•‘     â€¢ visitor_level: 'free' | 'vip'                                          â•‘
â•‘     â€¢ status: 'pending' | 'pending_payment' | 'active'                       â•‘
â•‘     â€¢ type: 'visitor'                                                        â•‘
â•‘     â€¢ profile.photoUrl: URL photo (VIP seulement)                            â•‘
â•‘     âœ… VALIDÃ‰                                                                 â•‘
â•‘                                                                                â•‘
â•‘  ğŸ« digital_badges                                                             â•‘
â•‘     â€¢ JWT token avec zones d'accÃ¨s                                           â•‘
â•‘     â€¢ QR data (JSON avec token + level + userId)                             â•‘
â•‘     â€¢ badge_type: 'visitor_free' | 'visitor_premium'                        â•‘
â•‘     â€¢ photo_url: Pour VIP                                                    â•‘
â•‘     â€¢ is_active: Permet bloquer l'accÃ¨s                                      â•‘
â•‘     â€¢ RLS Policies: Utilisateur voit son propre badge                        â•‘
â•‘     âœ… VALIDÃ‰                                                                 â•‘
â•‘                                                                                â•‘
â•‘  ğŸ’³ payment_requests                                                           â•‘
â•‘     â€¢ amount: 299.99 (VIP Premium)                                           â•‘
â•‘     â€¢ status: 'pending' â†’ 'completed'                                        â•‘
â•‘     â€¢ payment_method: 'stripe' | 'paypal'                                    â•‘
â•‘     â€¢ metadata: { type: 'visitor_vip_upgrade', ... }                         â•‘
â•‘     âœ… VALIDÃ‰                                                                 â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          TRANSITIONS D'Ã‰TAT                                    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘  VISITEUR GRATUIT:                                                            â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ START â†’ signUp â†’ INSERT (status='pending') â†’ Badge â†’ Email â†’ LOGOUT â”‚    â•‘
â•‘  â”‚                                                                       â”‚    â•‘
â•‘  â”‚ Status final: 'pending' (Email validation en attente)               â”‚    â•‘
â•‘  â”‚ Login: âŒ NON POSSIBLE (password alÃ©atoire)                          â”‚    â•‘
â•‘  â”‚ Badge: âœ… DISPONIBLE (QR code)                                       â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                                                â•‘
â•‘  VISITEUR VIP (Avant paiement):                                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ START â†’ signUp â†’ INSERT (status='pending_payment') â†’ Email â†’ LOGOUT â”‚    â•‘
â•‘  â”‚                                                                       â”‚    â•‘
â•‘  â”‚ Status: 'pending_payment' (ğŸ”´ LOCKED)                               â”‚    â•‘
â•‘  â”‚ Login: âŒ IMPOSSIBLE (status !== 'active')                           â”‚    â•‘
â•‘  â”‚ Badge: âŒ NON ENCORE GÃ‰NÃ‰RÃ‰                                          â”‚    â•‘
â•‘  â”‚ Dashboard: âŒ INACCESSIBLE                                           â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                                                â•‘
â•‘  VISITEUR VIP (AprÃ¨s paiement):                                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ Stripe webhook â†’ Badge (avec photo) â†’ Email conf â†’ Status='active'  â”‚    â•‘
â•‘  â”‚                                                                       â”‚    â•‘
â•‘  â”‚ Status: 'active' (âœ… UNLOCKED)                                       â”‚    â•‘
â•‘  â”‚ Login: âœ… POSSIBLE (credentials valides)                             â”‚    â•‘
â•‘  â”‚ Badge: âœ… DISPONIBLE (avec photo + JWT)                              â”‚    â•‘
â•‘  â”‚ Dashboard: âœ… ACCESSIBLE                                             â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            POINTS DE SÃ‰CURITÃ‰                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘  Authentication                                                               â•‘
â•‘  âœ… Password alÃ©atoire pour FREE (non-loginnable)                            â•‘
â•‘  âœ… Password rÃ©el + sÃ©curisÃ© pour VIP                                        â•‘
â•‘  âœ… Email validation required                                                â•‘
â•‘  âœ… VIP lockdown jusqu'Ã  paiement (status='pending_payment')                 â•‘
â•‘                                                                                â•‘
â•‘  Data Protection                                                              â•‘
â•‘  âœ… Photos dans Supabase Storage (bucket 'public')                           â•‘
â•‘  âœ… URL photo accessible publiquement (pour QR)                              â•‘
â•‘  âœ… RLS sur digital_badges (user voit seulement le sien)                     â•‘
â•‘  âœ… JWT token rotatif (30s interval par dÃ©faut)                              â•‘
â•‘  âœ… Nonce anti-replay dans JWT payload                                       â•‘
â•‘                                                                                â•‘
â•‘  Payment Security                                                             â•‘
â•‘  âœ… Stripe webhook signature verification                                    â•‘
â•‘  âœ… Metadata validation (userId, visitorLevel)                               â•‘
â•‘  âœ… Status transition: pending_payment â†’ active                              â•‘
â•‘  âœ… Email confirmation du paiement                                           â•‘
â•‘  âœ… Webhook idempotency (checks existing badge)                              â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        FICHIERS VALIDÃ‰S & IMPLANTÃ‰S                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘  âœ… src/pages/visitor/VisitorFreeRegistration.tsx (430 lignes)               â•‘
â•‘     - 7 Ã©tapes complÃ¨tes                                                     â•‘
â•‘     - Formulaire, Auth, Users insert, Badge, Email, Logout, Redirect        â•‘
â•‘                                                                                â•‘
â•‘  âœ… src/pages/visitor/VisitorVIPRegistration.tsx (601 lignes)                â•‘
â•‘     - Ã‰tapes 1-8 (inscription)                                               â•‘
â•‘     - Photo upload, Auth, Users insert, Payment request, Email, Redirect    â•‘
â•‘                                                                                â•‘
â•‘  âœ… src/pages/visitor/VisitorRegistrationChoice.tsx (319 lignes)             â•‘
â•‘     - Choice page entre FREE et VIP                                          â•‘
â•‘     - Routes correctes vers formulaires spÃ©cialisÃ©s                          â•‘
â•‘                                                                                â•‘
â•‘  âœ… supabase/functions/generate-visitor-badge/index.ts (225 lignes)          â•‘
â•‘     - JWT generation avec zones d'accÃ¨s                                      â•‘
â•‘     - QR data avec token + photo                                             â•‘
â•‘     - Storage dans digital_badges                                            â•‘
â•‘                                                                                â•‘
â•‘  âœ… supabase/functions/send-visitor-welcome-email/index.ts (391 lignes)      â•‘
â•‘     - Templates FREE et VIP                                                  â•‘
â•‘     - Support prÃ©-paiement et post-paiement                                  â•‘
â•‘     - Via Resend API                                                         â•‘
â•‘                                                                                â•‘
â•‘  âœ… supabase/functions/stripe-webhook/index.ts (238 lignes)                  â•‘
â•‘     - Ã‰tapes 9-12 post-paiement                                              â•‘
â•‘     - Badge generation, Email, Status activation                             â•‘
â•‘                                                                                â•‘
â•‘  âœ… supabase/migrations/20251219_create_digital_badges_table.sql (159 lignes)â•‘
â•‘     - Table digital_badges avec JWT + zones + photo                          â•‘
â•‘     - RLS policies                                                           â•‘
â•‘                                                                                â•‘
â•‘  âœ… src/lib/routes.ts                                                         â•‘
â•‘     - Toutes routes visiteur configurÃ©es                                     â•‘
â•‘     - Navigation correcte                                                    â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                             RÃ‰SUMÃ‰ FINAL                                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                â•‘
â•‘  ğŸŸ¢ WORKFLOW GRATUIT:    âœ… 100% COMPLET (7/7 Ã©tapes)                        â•‘
â•‘  ğŸŸ¢ WORKFLOW VIP:        âœ… 100% COMPLET (12/12 Ã©tapes)                      â•‘
â•‘  ğŸŸ¢ WEBHOOK STRIPE:      âœ… 100% COMPLET (Ã©tapes 9-11)                       â•‘
â•‘  ğŸŸ¢ EMAIL SYSTEM:        âœ… INTÃ‰GRÃ‰ (Resend API)                             â•‘
â•‘  ğŸŸ¢ SECURITY:            âœ… VALIDÃ‰ (RLS, JWT, Webhook verification)          â•‘
â•‘                                                                                â•‘
â•‘  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â•‘
â•‘  â•‘  ğŸ‰ SYSTÃˆME VISITEUR: PRÃŠT POUR PRODUCTION AVEC TESTS RÃ‰ELS           â•‘ â•‘
â•‘  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â•‘
â•‘                                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

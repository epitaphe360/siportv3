import { createClient } from '@supabase/supabase-js';
import dotenv from 'dotenv';

// Charger les variables d'environnement
dotenv.config();

const supabaseUrl = process.env.VITE_SUPABASE_URL;
const supabaseServiceKey = process.env.VITE_SUPABASE_SERVICE_ROLE_KEY;

if (!supabaseUrl || !supabaseServiceKey) {
  console.error('‚ùå Configuration Supabase manquante dans le fichier .env');
  console.error('V√©rifiez VITE_SUPABASE_URL et VITE_SUPABASE_SERVICE_ROLE_KEY');
  process.exit(1);
}

// Utiliser la cl√© service_role pour contourner les politiques RLS
const supabase = createClient(supabaseUrl, supabaseServiceKey, {
  auth: {
    autoRefreshToken: false,
    persistSession: false
  }
});

// Nouvelles actualit√©s enrichies
const newsArticles = [
  {
    id: 'news-001',
    title: 'Nouveau partenariat avec le Port de Rotterdam',
    excerpt: 'Une collaboration strat√©gique majeure pour d√©velopper les technologies portuaires de demain.',
    content: `SIPORTS annonce aujourd'hui un partenariat strat√©gique avec le Port de Rotterdam, leader europ√©en en mati√®re d'innovation portuaire. Cette collaboration vise √† d√©velopper conjointement des solutions technologiques avanc√©es pour l'optimisation des op√©rations portuaires et la r√©duction de l'empreinte carbone.

Le partenariat couvre plusieurs domaines cl√©s :

‚Ä¢ Technologies IoT pour la surveillance en temps r√©el des infrastructures
‚Ä¢ Solutions d'intelligence artificielle pour l'optimisation des flux logistiques
‚Ä¢ D√©veloppement durable et transition √©nerg√©tique des ports
‚Ä¢ Formation et partage d'expertise technique

"Ce partenariat repr√©sente une √©tape majeure dans notre strat√©gie de d√©veloppement international", d√©clare le Directeur G√©n√©ral de SIPORTS. "Le savoir-faire du Port de Rotterdam combin√© √† notre expertise technologique nous permettra d'offrir des solutions innovantes √† l'√©chelle mondiale."`,
    author: '√âquipe SIPORTS',
    published_at: new Date('2024-01-14'),
    category: 'Partenariat',
    tags: ['partenariat', 'rotterdam', 'collaboration', 'innovation'],
    featured: true,
    image_url: 'https://images.pexels.com/photos/3184338/pexels-photo-3184338.jpeg',
    read_time: 4,
    source: 'siports',
    views: 2100,
    status: 'published'
  },
  {
    id: 'news-002',
    title: 'Lancement de la version 3.0 de SmartPort',
    excerpt: 'La nouvelle version r√©volutionne la gestion portuaire avec des fonctionnalit√©s d\'IA avanc√©es.',
    content: `Apr√®s deux ans de d√©veloppement intensif, SIPORTS lance aujourd'hui la version 3.0 de sa plateforme SmartPort, int√©grant les derni√®res avanc√©es en intelligence artificielle et en analyse pr√©dictive.

Les principales nouveaut√©s de cette version majeure :

üöÄ Intelligence Artificielle Avanc√©e
‚Ä¢ Pr√©diction des flux de conteneurs avec une pr√©cision de 95%
‚Ä¢ Optimisation automatique des ressources portuaires
‚Ä¢ D√©tection pr√©coce des anomalies op√©rationnelles

üìä Analytics en Temps R√©el
‚Ä¢ Tableaux de bord personnalisables pour chaque utilisateur
‚Ä¢ M√©triques de performance en continu
‚Ä¢ Rapports automatis√©s et alertes intelligentes

üîí S√©curit√© Renforc√©e
‚Ä¢ Chiffrement de bout en bout des donn√©es sensibles
‚Ä¢ Authentification multi-facteurs obligatoire
‚Ä¢ Tra√ßabilit√© compl√®te des actions utilisateurs

üå± D√©veloppement Durable
‚Ä¢ Calcul automatique de l'empreinte carbone
‚Ä¢ Optimisation des consommations √©nerg√©tiques
‚Ä¢ Suivi des objectifs de d√©veloppement durable

"SmartPort 3.0 repr√©sente un saut technologique majeur qui positionne SIPORTS comme leader incontest√© de la digitalisation portuaire", affirme l'√©quipe de d√©veloppement.`,
    author: '√âquipe Technique SIPORTS',
    published_at: new Date('2024-01-09'),
    category: 'Innovation',
    tags: ['smartport', 'version-3.0', 'ia', 'digitalisation'],
    featured: true,
    image_url: 'https://images.pexels.com/photos/3184339/pexels-photo-3184339.jpeg',
    read_time: 6,
    source: 'siports',
    views: 1850,
    status: 'published'
  },
  {
    id: 'news-003',
    title: 'Expansion Internationale : Ouverture de Bureaux en Asie',
    excerpt: 'SIPORTS √©tend sa pr√©sence mondiale avec l\'inauguration de ses premiers bureaux asiatiques.',
    content: `Dans le cadre de sa strat√©gie de d√©veloppement international, SIPORTS annonce l'ouverture de ses premiers bureaux en Asie, situ√©s √† Singapour et Shanghai. Cette expansion strat√©gique vise √† renforcer la pr√©sence de l'entreprise sur le march√© asiatique en pleine croissance.

Les nouveaux bureaux accueilleront :

‚Ä¢ Une √©quipe d'experts techniques locaux
‚Ä¢ Un centre de formation r√©gional
‚Ä¢ Un showroom technologique permanent
‚Ä¢ Des services de support 24/7 pour la zone Asie-Pacifique

Cette initiative s'inscrit dans la volont√© de SIPORTS d'accompagner au plus pr√®s ses clients asiatiques et de s'adapter aux sp√©cificit√©s r√©gionales du march√© portuaire.`,
    author: 'Direction Internationale',
    published_at: new Date('2024-01-05'),
    category: 'Expansion',
    tags: ['expansion', 'asie', 'singapour', 'shanghai'],
    featured: false,
    image_url: 'https://images.pexels.com/photos/3184293/pexels-photo-3184293.jpeg',
    read_time: 3,
    source: 'siports',
    views: 950,
    status: 'published'
  },
  {
    id: 'news-004',
    title: 'Conf√©rence sur la Transition √âcologique des Ports',
    excerpt: 'Experts mondiaux r√©unis pour discuter des strat√©gies de d√©carbonation du secteur portuaire.',
    content: `SIPORTS organise une conf√©rence internationale sur la transition √©cologique des ports, rassemblant plus de 200 experts et d√©cideurs du secteur. L'√©v√©nement se tiendra les 15 et 16 f√©vrier 2024 √† Marseille.

Les th√®mes principaux abord√©s :

‚Ä¢ Strat√©gies de r√©duction des √©missions de CO2
‚Ä¢ Technologies vertes pour les op√©rations portuaires
‚Ä¢ Financement de la transition √©nerg√©tique
‚Ä¢ R√©glementation environnementale internationale
‚Ä¢ Cas d'usage et retours d'exp√©rience

Cette conf√©rence constitue une plateforme unique d'√©change entre acteurs publics et priv√©s pour acc√©l√©rer la transition √©cologique du secteur portuaire.`,
    author: 'Comit√© Scientifique',
    published_at: new Date('2024-01-03'),
    category: '√âv√©nements',
    tags: ['environnement', 'transition', 'conf√©rence', 'd√©veloppement-durable'],
    featured: false,
    image_url: 'https://images.pexels.com/photos/3184294/pexels-photo-3184294.jpeg',
    read_time: 4,
    source: 'siports',
    views: 720,
    status: 'published'
  },
  {
    id: 'news-005',
    title: 'Prix de l\'Innovation Portuaire 2024',
    excerpt: 'D√©couvrez les laur√©ats du prestigieux Prix de l\'Innovation Portuaire d√©cern√© par SIPORTS.',
    content: `Pour la troisi√®me ann√©e cons√©cutive, SIPORTS a d√©cern√© ses Prix de l'Innovation Portuaire lors d'une c√©r√©monie prestigieuse. Cette ann√©e, plus de 150 candidatures ont √©t√© re√ßues, d√©montrant l'effervescence innovante du secteur.

Les laur√©ats 2024 :

ü•á Cat√©gorie Technologie : "PortVision AI" - Syst√®me de vision par ordinateur pour l'inspection automatique des conteneurs
ü•à Cat√©gorie Durabilit√© : "GreenPort Solutions" - Plateforme d'optimisation √©nerg√©tique des terminaux
ü•â Cat√©gorie S√©curit√© : "SecureHarbor" - Solution de cybers√©curit√© int√©gr√©e pour les infrastructures portuaires

üèÜ Prix Sp√©cial du Jury : "MaritimeChain" - Blockchain pour la tra√ßabilit√© des cha√Ænes logistiques maritimes

Ces innovations t√©moignent de la vitalit√© du secteur portuaire et de son engagement dans la transformation digitale et durable.`,
    author: 'Jury des Prix',
    published_at: new Date('2023-12-20'),
    category: 'Prix',
    tags: ['prix', 'innovation', 'r√©compenses', 'technologie'],
    featured: false,
    image_url: 'https://images.pexels.com/photos/3184295/pexels-photo-3184295.jpeg',
    read_time: 5,
    source: 'siports',
    views: 1100,
    status: 'published'
  },
  {
    id: 'news-006',
    title: 'Formation Continue : Nouveau Programme de Certification',
    excerpt: 'SIPORTS lance un programme complet de formation et certification pour les professionnels du secteur.',
    content: `Afin de r√©pondre aux besoins croissants en comp√©tences techniques du secteur portuaire, SIPORTS lance un nouveau programme de formation continue et de certification professionnelle.

Le programme comprend :

üìö Modules de Formation
‚Ä¢ Technologies portuaires avanc√©es
‚Ä¢ Gestion des op√©rations logistiques
‚Ä¢ Cybers√©curit√© des infrastructures critiques
‚Ä¢ D√©veloppement durable et transition √©nerg√©tique

üéì Certifications Disponibles
‚Ä¢ Certificat de Sp√©cialiste SmartPort
‚Ä¢ Certification Gestionnaire d'Op√©rations Portuaires
‚Ä¢ Dipl√¥me Expert en Technologies Portuaires

üíº Avantages
‚Ä¢ Formation 100% en ligne avec accompagnement personnalis√©
‚Ä¢ Reconnaissance internationale des certifications
‚Ä¢ Mise √† jour continue des contenus p√©dagogiques
‚Ä¢ R√©seau professionnel des alumni

Les inscriptions pour la premi√®re session sont ouvertes jusqu'au 31 mars 2024.`,
    author: 'Direction Formation',
    published_at: new Date('2023-12-15'),
    category: 'Formation',
    tags: ['formation', 'certification', 'comp√©tences', 'professionnel'],
    featured: false,
    image_url: 'https://images.pexels.com/photos/3184296/pexels-photo-3184296.jpeg',
    read_time: 4,
    source: 'siports',
    views: 680,
    status: 'published'
  }
];

async function seedNewsData() {
  console.log('üì∞ Insertion des actualit√©s enrichies dans Supabase...\n');

  try {
    // D'abord, essayer de cr√©er la table si elle n'existe pas
    console.log('üîß Tentative de cr√©ation de la table news...');

    try {
      // Cette requ√™te peut √©chouer si la table existe d√©j√†, c'est normal
      await supabase.from('news').select('id').limit(1);
      console.log('‚úÖ Table news existe d√©j√†');
    } catch (tableError) {
      console.log('‚ÑπÔ∏è Table news n\'existe pas encore - elle doit √™tre cr√©√©e manuellement dans Supabase');
      console.log('ÔøΩ Instructions:');
      console.log('1. Allez dans votre dashboard Supabase');
      console.log('2. Ouvrez l\'√©diteur SQL');
      console.log('3. Ex√©cutez le contenu du fichier scripts/create-news-table.sql');
      console.log('4. Relancez ce script\n');
      return;
    }

    // Ins√©rer les actualit√©s
    console.log('üìù Insertion des actualit√©s...');

    for (const article of newsArticles) {
      try {
        console.log(`üìÑ Insertion: ${article.title}`);

        // Adapter les donn√©es pour Supabase
        const articleData = {
          id: article.id,
          title: article.title,
          excerpt: article.excerpt,
          content: article.content,
          author: article.author,
          published_at: article.published_at.toISOString(),
          category: article.category,
          tags: article.tags,
          featured: article.featured,
          image_url: article.image_url,
          read_time: article.read_time,
          source: article.source,
          views: article.views,
          status: article.status
        };

        const { error } = await supabase.from('news').upsert(articleData);

        if (error) {
          console.error(`‚ùå Erreur insertion article "${article.title}":`, error.message);
          console.error('D√©tails:', error.details);
        } else {
          console.log(`‚úÖ Article ins√©r√©: ${article.title}`);
        }
      } catch (err) {
        console.error(`‚ùå Exception lors de l'insertion de "${article.title}":`, err.message);
      }
    }

    console.log('\nüéâ Actualit√©s ins√©r√©es avec succ√®s!');
    console.log('\nüìä Statistiques des actualit√©s:');
    console.log('================================');
    console.log(`üì∞ Total articles: ${newsArticles.length}`);
    console.log(`‚≠ê Articles featured: ${newsArticles.filter(a => a.featured).length}`);
    console.log(`üëÅÔ∏è Total vues: ${newsArticles.reduce((sum, a) => sum + a.views, 0)}`);
    console.log(`üìñ Temps de lecture total: ${newsArticles.reduce((sum, a) => sum + a.read_time, 0)} minutes`);

    const categories = [...new Set(newsArticles.map(a => a.category))];
    console.log(`üè∑Ô∏è Cat√©gories: ${categories.join(', ')}`);

    console.log('\nüîÑ Actualisez votre application pour voir les nouvelles actualit√©s!');

  } catch (error) {
    console.error('‚ùå Erreur lors de l\'insertion des actualit√©s:', error);
    console.error('Stack trace:', error.stack);
  }
}

seedNewsData();
